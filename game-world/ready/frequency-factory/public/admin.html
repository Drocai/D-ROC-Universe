<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Frequency Factory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #00f5ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #888;
            font-size: 1.1em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #00f5ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #888;
            margin-top: 5px;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 1px;
        }

        .auth-required {
            text-align: center;
            padding: 40px;
        }

        .auth-required h2 {
            margin-bottom: 20px;
            color: #ff00ff;
        }

        .auth-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #00f5ff, #ff00ff);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(0, 245, 255, 0.2);
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #888;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: #00f5ff;
            border-bottom-color: #00f5ff;
        }

        .submissions-list {
            display: grid;
            gap: 20px;
        }

        .submission-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            display: grid;
            grid-template-columns: 100px 1fr auto;
            gap: 20px;
            align-items: center;
        }

        .submission-card.pending {
            border-color: rgba(255, 165, 0, 0.5);
            background: rgba(255, 165, 0, 0.05);
        }

        .cover-art {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid rgba(0, 245, 255, 0.3);
        }

        .track-info h3 {
            color: #00f5ff;
            margin-bottom: 5px;
        }

        .track-info .artist {
            color: #ff00ff;
            margin-bottom: 10px;
        }

        .track-meta {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 15px;
        }

        .track-meta span {
            margin-right: 15px;
        }

        .audio-player {
            margin-top: 10px;
        }

        .audio-player audio {
            width: 100%;
            max-width: 400px;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }

        .btn-approve {
            background: linear-gradient(135deg, #00ff64, #00cc50);
            color: #fff;
        }

        .btn-approve:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 100, 0.4);
        }

        .btn-reject {
            background: linear-gradient(135deg, #ff0064, #cc0050);
            color: #fff;
        }

        .btn-reject:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 0, 100, 0.4);
        }

        .btn-delete {
            background: rgba(100, 100, 100, 0.3);
            color: #ff0064;
            border: 1px solid #ff0064;
        }

        .btn-delete:hover {
            background: rgba(255, 0, 100, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .back-link {
            display: block;
            text-align: center;
            margin-top: 30px;
            color: #00f5ff;
            text-decoration: none;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #ff00ff;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        @media (max-width: 768px) {
            .submission-card {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .cover-art {
                margin: 0 auto;
            }

            .actions {
                flex-direction: row;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéõÔ∏è ADMIN DASHBOARD</h1>
            <p>Frequency Factory - Track Management</p>
        </div>

        <div id="authRequired" class="auth-required" style="display: none;">
            <h2>üîê Admin Access Required</h2>
            <p style="margin-bottom: 20px; color: #888;">You need to be logged in as an admin</p>
            <a href="index.html" class="auth-btn">Go to Login</a>
        </div>

        <div id="dashboard" style="display: none;">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="pendingCount">0</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="approvedCount">0</div>
                    <div class="stat-label">Approved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">Total Tracks</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('pending')">‚è≥ Pending Review</button>
                <button class="tab" onclick="switchTab('approved')">‚úÖ Approved</button>
                <button class="tab" onclick="switchTab('rejected')">‚ùå Rejected</button>
            </div>

            <div id="pendingTab" class="submissions-list"></div>
            <div id="approvedTab" class="submissions-list" style="display: none;"></div>
            <div id="rejectedTab" class="submissions-list" style="display: none;"></div>

            <a href="index.html" class="back-link">‚Üê Back to Factory</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, query, where, onSnapshot, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBSLS3v_c9aaCdNXILMEKeyXKEbBP6jKjU",
            authDomain: "factory-1-e7ef3.firebaseapp.com",
            projectId: "factory-1-e7ef3",
            storageBucket: "factory-1-e7ef3.firebasestorage.app",
            messagingSenderId: "656280780334",
            appId: "1:656280780334:web:39f5a9f40d6870aea862e7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // IMPORTANT: Add your admin email here
        const ADMIN_EMAILS = [
            'factoryfrequency@gmail.com'  // Replace with your actual email
        ];

        let currentUser = null;
        let currentTab = 'pending';

        // Check auth state
        onAuthStateChanged(auth, (user) => {
            if (user && ADMIN_EMAILS.includes(user.email)) {
                currentUser = user;
                document.getElementById('authRequired').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadTracks();
            } else {
                document.getElementById('authRequired').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        function loadTracks() {
            // Listen to pending tracks
            const pendingQuery = query(collection(db, 'tracks'), where('status', '==', 'pending'));
            onSnapshot(pendingQuery, (snapshot) => {
                const tracks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                document.getElementById('pendingCount').textContent = tracks.length;
                renderTracks(tracks, 'pendingTab', 'pending');
            });

            // Listen to approved tracks
            const approvedQuery = query(collection(db, 'tracks'), where('status', '==', 'approved'));
            onSnapshot(approvedQuery, (snapshot) => {
                const tracks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                document.getElementById('approvedCount').textContent = tracks.length;
                renderTracks(tracks, 'approvedTab', 'approved');
            });

            // Listen to rejected tracks
            const rejectedQuery = query(collection(db, 'tracks'), where('status', '==', 'rejected'));
            onSnapshot(rejectedQuery, (snapshot) => {
                const tracks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderTracks(tracks, 'rejectedTab', 'rejected');
            });

            // Total count
            onSnapshot(collection(db, 'tracks'), (snapshot) => {
                document.getElementById('totalCount').textContent = snapshot.size;
            });
        }

        function renderTracks(tracks, containerId, status) {
            const container = document.getElementById(containerId);
            
            if (tracks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No ${status} tracks</h3>
                        <p>All clear! üéâ</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = tracks.map(track => {
                const submittedDate = track.submittedAt?.toDate?.() || new Date();
                
                return `
                    <div class="submission-card ${status}">
                        <img src="${track.coverArt}" alt="Cover" class="cover-art">
                        
                        <div class="track-info">
                            <h3>${track.title}</h3>
                            <div class="artist">${track.artist}</div>
                            <div class="track-meta">
                                <span>üìß ${track.submittedByEmail || 'Unknown'}</span>
                                <span>üìÖ ${submittedDate.toLocaleDateString()}</span>
                                <span>‚è∞ ${submittedDate.toLocaleTimeString()}</span>
                            </div>
                            <div class="audio-player">
                                <audio controls>
                                    <source src="${track.audioUrl}" type="audio/mpeg">
                                </audio>
                            </div>
                        </div>
                        
                        <div class="actions">
                            ${status === 'pending' ? `
                                <button class="btn btn-approve" onclick="approveTrack('${track.id}')">
                                    ‚úÖ Approve
                                </button>
                                <button class="btn btn-reject" onclick="rejectTrack('${track.id}')">
                                    ‚ùå Reject
                                </button>
                            ` : ''}
                            ${status === 'approved' ? `
                                <button class="btn btn-reject" onclick="rejectTrack('${track.id}')">
                                    ‚ùå Unpublish
                                </button>
                            ` : ''}
                            ${status === 'rejected' ? `
                                <button class="btn btn-approve" onclick="approveTrack('${track.id}')">
                                    ‚úÖ Approve
                                </button>
                                <button class="btn btn-delete" onclick="deleteTrack('${track.id}')">
                                    üóëÔ∏è Delete
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.switchTab = function(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide content
            document.getElementById('pendingTab').style.display = tab === 'pending' ? 'grid' : 'none';
            document.getElementById('approvedTab').style.display = tab === 'approved' ? 'grid' : 'none';
            document.getElementById('rejectedTab').style.display = tab === 'rejected' ? 'grid' : 'none';
        };

        window.approveTrack = async function(trackId) {
            if (!confirm('Approve this track? It will go live immediately.')) return;
            
            try {
                await updateDoc(doc(db, 'tracks', trackId), {
                    status: 'approved',
                    approvedAt: new Date(),
                    approvedBy: currentUser.uid
                });
                alert('‚úÖ Track approved!');
            } catch (error) {
                console.error('Error approving track:', error);
                alert('Error approving track: ' + error.message);
            }
        };

        window.rejectTrack = async function(trackId) {
            if (!confirm('Reject this track?')) return;
            
            try {
                await updateDoc(doc(db, 'tracks', trackId), {
                    status: 'rejected',
                    rejectedAt: new Date(),
                    rejectedBy: currentUser.uid
                });
                alert('‚ùå Track rejected');
            } catch (error) {
                console.error('Error rejecting track:', error);
                alert('Error rejecting track: ' + error.message);
            }
        };

        window.deleteTrack = async function(trackId) {
            if (!confirm('Permanently delete this track? This cannot be undone.')) return;
            
            try {
                await deleteDoc(doc(db, 'tracks', trackId));
                alert('üóëÔ∏è Track deleted');
            } catch (error) {
                console.error('Error deleting track:', error);
                alert('Error deleting track: ' + error.message);
            }
        };
    </script>
</body>
</html>
